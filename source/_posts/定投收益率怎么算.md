---
title: 定投收益率怎么算
urlname: mdqa85w2
comments: true
mathjax: true
date: 2019-05-03 15:03:00
categories:
- 理财
tags:
- 理财
description: 自己定投到底收益率如何，好好算个清楚
---

假设你定投一支基金12个月，每个月投入1000块，一共投入了12000，年末一看，手里的基金净值是12600，那么请问，你定投的年化收益率是多少？为了方便，制表如下：

| 时间       | 金额  |
| ---------- | ----- |
| 2018-01-01 | -1000 |
| 2018-02-01 | -1000 |
| ....       | ....  |
| 2018-11-01 | -1000 |
| 2018-12-01 | -1000 |
| 2019-01-01 | 12600 |

一般我们会这样算年化收益率

 $\frac{12600-12000}{12000} = 5\%$

乍一看没什么问题，定投收益率也不高。仔细一想是有问题的，除了2018年1月1日投入的那一笔1000元是完整地产生了一年的收益，其他每一笔投资其实是不到一年的，也就是说12000的投入，平均时长是不到一年的。因此这样计算是错误的。

---

正确的计算方法应该是这样的，定投的收益也应该按照日复利来计算，假设日利率为$r_{day}$，然后将每一笔金额（包括收入和支出），都以该日利率算出到结算日的最终金额，最后和应该为0。再通过一些数学方法解出$r_{day}$，计算出对应的年化收益率。

下面拿个例子演示一下，为了方便，按月定投两期，最终2000变2040：

| 时间       | 金额  |
| ---------- | ----- |
| 2018-06-01 | -1000 |
| 2018-07-01 | -1000 |
| 2018-08-01 | 2040  |

对应的方程应该是这样的，都是以日复利来计算的：

$$(-1000)\times(1+r_{day})^{61} +(-1000)\times(1+r_{day})^{31}+2040=0$$

通过上式解出日利率$r_{day}$为0.04301%

那么年化收益率$r_{year}=(1+r_{day})^{365}-1$，为16.9954%

---

下面用派森，把这个东西做成一个小工具，来计算一下下面这种情况下的收益率

| 时间       | 金额     |
| ---------- | -------- |
| 2016-11-15 | -1000    |
| 2016-12-10 | -1000    |
| 2017-01-13 | -1000    |
| 2017-02-25 | -1000    |
| 2017-03-01 | -1000    |
| 2017-04-10 | -1000    |
| 2017-05-15 | -1000    |
| 2017-06-11 | -1000    |
| 2017-07-22 | -1000    |
| 2017-08-19 | -1000    |
| 2017-09-14 | -1000    |
| 2017-10-09 | -1000    |
| 2017-10-15 | 13500.17 |

首先，录入时间和金额

```python
flow = [('2016-11-15', -1000), 
        ('2016-12-10', -1000),
        ('2017-01-13', -1000),
        ('2017-02-25', -1000),
        ('2017-03-01', -1000),
        ('2017-04-10', -1000),
        ('2017-05-15', -1000),
        ('2017-06-11', -1000),
        ('2017-07-22', -1000),
        ('2017-08-19', -1000),
        ('2017-09-14', -1000),
        ('2017-10-09', -1000),
        ('2017-10-15', 13500.17)]
```

写一个简单的函数来计算两天之间差了多少时间

```python
def day_diff(end_day, start_day):
    end = datetime.strptime(end_day, '%Y-%m-%d')
    start = datetime.strptime(start_day, '%Y-%m-%d')
    return (end - start).days
print(day_diff('2018-12-15', '2017-10-14')) ##输出427
```

下面祭出最终计算定投年化收益率的函数，实现细节不多说了：

```python
def xirr(cash_flow):
    def function(c_f):
        def f(rate):
            total = 0
            for i in c_f:
                start_amount = i[1]
                start_date = i[0]
                end_date = c_f[-1][0]
                total += start_amount * np.power((1 + rate), day_diff(end_date, start_date))
            return total
        return f
    rate_day = optimize.newton(function(cash_flow), x0=0.01)
    rate_year = np.power(1 + rate_day, 365) - 1
    return rate_year
```

试试结果吧

```python
xirr(flow)
```

> 0.2831443972022636

年化收益率在28%左右

---

我们回头来算一下，开头那个定投1000，一年后12600的例子，计算结果是:

9.32% !!!

是不是这样看，这笔定投的收益率是非常高的。

---

另外多提一句，为什么函数名我要写成xirr

实际上在百度百科的解释中：

> XIRR反映一组现金流的内部收益率，这些现金流不一定定期发生

这个其实就是我们现在正在进行计算所需要的东西。在excel中也有对应的实现，可以去试一试，计算方法可能与我的算法有一点点出入，但是基本上应该是一样的。

---

再再再多提一句，xirr不仅可以计算投资的收益率，还可以计算很多生活中实际的问题，比如，我报名了python培训班，投入了10000块钱，可以记为现金流的-10000，然后在两年中，每个月多赚了500块钱。那么从这个两年时间看，这笔投资的年化收益率是多少？如果时间放宽到10年，那么年化收益率又是多少？

---

附上完整python代码

```python
from datetime import datetime
from sympy import solve, symbols
import numpy as np
from scipy import optimize

flow = [('2016-11-15', -1000), 
        ('2016-12-10', -1000),
        ('2017-01-13', -1000),
        ('2017-02-25', -1000),
        ('2017-03-01', -1000),
        ('2017-04-10', -1000),
        ('2017-05-15', -1000),
        ('2017-06-11', -1000),
        ('2017-07-22', -1000),
        ('2017-08-19', -1000),
        ('2017-09-14', -1000),
        ('2017-10-09', -1000),
        ('2017-10-15', 13500.17)]
        
def day_diff(end_day, start_day):
    end = datetime.strptime(end_day, '%Y-%m-%d')
    start = datetime.strptime(start_day, '%Y-%m-%d')
    return (end - start).days
print(day_diff('2018-12-15', '2017-10-14'))

def xirr(cash_flow):
    def function(c_f):
        def f(rate):
            total = 0
            for i in c_f:
                start_amount = i[1]
                start_date = i[0]
                end_date = c_f[-1][0]
                total += start_amount * np.power((1 + rate), day_diff(end_date, start_date))
            return total
        return f
    rate_day = optimize.newton(function(cash_flow), x0=0.01)
    rate_year = np.power(1 + rate_day, 365) - 1
    return rate_year

print(xirr(flow))
```

